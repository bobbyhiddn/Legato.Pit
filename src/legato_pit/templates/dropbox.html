{% extends "base.html" %}

{% block title %}Motif - {{ app_name }}{% endblock %}

{% block content %}
<div class="dropbox">
    <header class="page-header">
        <h1>Motif</h1>
        <p class="subtitle">Drop a musical idea into the system</p>
    </header>

    <form action="{{ url_for('dropbox.upload') }}" method="POST" enctype="multipart/form-data" class="upload-form">
        <div class="form-section">
            <label class="form-label">Input Method</label>

            <div class="upload-tabs">
                <button type="button" class="tab-btn active" onclick="showTab('text')">Paste Text</button>
                <button type="button" class="tab-btn" onclick="showTab('file')">Upload File</button>
            </div>

            <div id="tab-text" class="tab-content active">
                <textarea id="transcript" name="transcript"
                          class="form-textarea"
                          placeholder="Paste your motif here - a voice transcript, idea, thought, or any text to process..."
                          rows="10"></textarea>
                <span class="form-hint">Max 500KB</span>
            </div>

            <div id="tab-file" class="tab-content">
                <div class="file-upload-area" onclick="document.getElementById('file').click()">
                    <input type="file" id="file" name="file" accept=".txt,.md,.text" class="file-input">
                    <div class="file-upload-content">
                        <svg class="upload-icon" viewBox="0 0 24 24" width="48" height="48">
                            <path fill="currentColor" d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/>
                        </svg>
                        <p class="upload-text">Tap to select file</p>
                        <p class="upload-hint">.txt or .md files only</p>
                    </div>
                </div>
                <div id="file-name" class="file-name-display"></div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-large btn-submit">
            Submit Transcript
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function showTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    // Update tab content
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');

    // Clear the other input when switching
    if (tab === 'text') {
        document.getElementById('file').value = '';
        document.getElementById('file-name').textContent = '';
    } else {
        document.getElementById('transcript').value = '';
    }
}

// File input handling
document.getElementById('file').addEventListener('change', function(e) {
    const fileName = e.target.files[0]?.name || '';
    document.getElementById('file-name').textContent = fileName;

    if (fileName) {
        document.querySelector('.file-upload-content').innerHTML = `
            <svg class="upload-icon success" viewBox="0 0 24 24" width="48" height="48">
                <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
            </svg>
            <p class="upload-text">${fileName}</p>
            <p class="upload-hint">Tap to change</p>
        `;
    }
});

// Prevent form submission if no content
document.querySelector('.upload-form').addEventListener('submit', function(e) {
    const text = document.getElementById('transcript').value.trim();
    const file = document.getElementById('file').files[0];

    if (!text && !file) {
        e.preventDefault();
        showWarning('Please enter text or select a file to upload.');
    }
});
</script>
{% endblock %}
